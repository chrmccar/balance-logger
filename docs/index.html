<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Balance Logger Files</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 2rem; color: #333; }
    h1 { font-size: 2rem; color: #2c3e50; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: white; }
    th, td { border: 1px solid #ccc; padding: 0.8rem; text-align: left; }
    th { background: #3498db; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    a.button { background: #3498db; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; }
    a.button:hover { background: #2980b9; }
  </style>
</head>
<body>
  <h1>Available Balance Logger CSV Files</h1>

  <table id="file-list">
    <thead>
      <tr>
        <th>File Name</th>
        <th>Last Updated</th>
        <th>Download</th>
      </tr>
    </thead>
    <tbody>
      <!-- Files will be inserted here dynamically -->
    </tbody>
  </table>

  <script>
    const repo = "chrmccar/balance-logger";
    const branch = "master";
    const dataFolderUrl = `https://api.github.com/repos/${repo}/contents/data`;

    fetch(dataFolderUrl)
      .then(response => response.json())
      .then(files => {
        const table = document.getElementById('file-list').querySelector('tbody');

        files.forEach(file => {
          if (file.name.endsWith('.csv')) {
            const row = document.createElement('tr');

            const nameCell = document.createElement('td');
            const link = document.createElement('a');
            link.href = `view.html?file=${encodeURIComponent(file.name)}`;
            link.textContent = file.name;
            nameCell.appendChild(link);
            row.appendChild(nameCell);

            const timeCell = document.createElement('td');
            const updatedAt = new Date(file.git_url ? file.git_url.split('commits/')[1] : file.sha);  // fallback
            const now = new Date();
            const diff = (now - new Date(file.last_modified || file.git_url || now)) / 1000;

            if (diff > 24 * 3600) {
              timeCell.textContent = ">24 hours ago";
            } else if (diff > 3600) {
              timeCell.textContent = `${Math.floor(diff/3600)} hours ago`;
            } else if (diff > 60) {
              timeCell.textContent = `${Math.floor(diff/60)} minutes ago`;
            } else {
              timeCell.textContent = `${Math.floor(diff)} seconds ago`;
            }
            row.appendChild(timeCell);

            const downloadCell = document.createElement('td');
            const downloadLink = document.createElement('a');
            downloadLink.href = `https://raw.githubusercontent.com/${repo}/${branch}/data/${file.name}`;
            downloadLink.className = "button";
            downloadLink.download = file.name;
            downloadLink.textContent = "Download";
            downloadCell.appendChild(downloadLink);
            row.appendChild(downloadCell);

            table.appendChild(row);
          }
        });
      })
      .catch(err => {
        const table = document.getElementById('file-list').querySelector('tbody');
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 3;
        cell.textContent = "Error loading file list.";
        row.appendChild(cell);
        table.appendChild(row);
      });
  </script>

</body>
</html>
